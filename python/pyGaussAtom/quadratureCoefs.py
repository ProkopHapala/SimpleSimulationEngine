#!/usr/bin/env python

from __future__ import division  #just for compactibility on python 2
from pylab import *
from scipy.fftpack import ifft

# Newton-Cotes
# http://en.wikipedia.org/wiki/Newton%E2%80%93Cotes_formulas
# http://people.oregonstate.edu/~peterseb/mth351/docs/newton_cotes.pdf

NewtonCotesCoefs = [
 [    1/2.0,          1/2.0],
 [    1/6.0,          2/3.0,           1/6.0 ],
 [    1/8.0,          3/8.0,           3/8.0,         1/8.0  ],
 [    7/90.0,        16/45.0,          2/15.0,       16/45.0,       7/90.0 ],
 [   19/288.0,       25/96.0,         25/144.0,      25/144.0,     25/96.0,       19/288.0 ],
 [   41/840.0,        9/35.0,          9/280.0,      34/105.0,      9/280.0,       9/35.0,       41/840.0 ], 
 [  751/17280.0,   3577/17280.0,      49/640.0,    2989/17280.0, 2989/17280.0,    49/640.0,    3577/17280.0,  751/17280.0 ],
 [  989/28350.0,   2944/14175.0,    -464/14175.0,  5248/14175.0, -454/2835.0,   5248/14175.0,  -464/14175.0, 2944/14175.0,     989/28350.0 ],
 [ 2857/89600.0,  15741/89600.0,      27/2240.0,   1209/5600.0,  2889/44800.0,  2889/44800.0,  1209/5600.0,    27/2240.0,    15741/89600.0,   2857/89600.0 ],
 [16067/598752.0, 26575/149688.0, -16175/199584.0, 5675/12474.0,  -4825/11088.0, 17807/24948.0, -4825/11088.0, 5675/12474.0,  -16175/199584.0, 26575/149688.0, 16067/598752.0 ]
]


# Gauss-Legendre Quadrature
#http://en.wikipedia.org/wiki/Gaussian_quadrature
#http://www.scientificpython.net/1/post/2012/04/gausslegendre1.html

def GaussLegendreCoefs(N):
	# Initial approximation to roots of the Legendre polynomial
	a = linspace(3,4*N-1,N)/(4*N+2)
	x = cos(pi*a+1/(8*N*N*tan(a)))
	# Find roots using Newton's method
	epsilon = 1e-15
	#epsilon = 1e-17
	delta = 1.0
	while delta>epsilon:
		p0 = ones(N,float)
		p1 = copy(x)
		for k in range(1,N):
			p0,p1 = p1,((2*k+1)*x*p1-k*p0)/(k+1)
		dp = (N+1)*(p0-x*p1)/(1-x*x)
		dx = p1/dp
		x -= dx
		delta = max(abs(dx))
	w = 2*(N+1)*(N+1)/(N*N*(1-x*x)*dp*dp)
	return 0.5*(x+1.0),w*0.5
	#return 10*x,w

GaussLegendreNodes = [	
[0.8872983346207417, 0.49999999999999994, 0.1127016653792583],
[0.93056815579702623, 0.66999052179242802, 0.33000947820757176, 0.069431844202973714],
[0.95308992296933193, 0.7692346550528415, 0.49999999999999994, 0.23076534494715839, 0.046910077030667963],
[0.96623475710157603, 0.83060469323313224, 0.61930959304159838, 0.38069040695840151, 0.1693953067668677, 0.033765242898423975],
[0.97455395617137919, 0.87076559279969723, 0.70292257568869854, 0.5, 0.29707742431130141, 0.12923440720030277, 0.025446043828620757],
[0.9801449282487682, 0.89833323870681336, 0.7627662049581645, 0.59171732124782483, 0.40828267875217505, 0.2372337950418355, 0.10166676129318664, 0.019855071751231856],
[0.98408011975381304, 0.91801555366331788, 0.80668571635029518, 0.6621267117019044, 0.5, 0.33787328829809554, 0.19331428364970482, 0.081984446336682115, 0.015919880246186957],
[0.98695326425858587, 0.93253168334449221, 0.83970478414951222, 0.7166976970646235, 0.57443716949081558, 0.42556283050918436, 0.28330230293537639, 0.16029521585048778, 0.067468316655507732, 0.013046735741414128],
[0.98911432907302843, 0.94353129988404771, 0.86507600278702468, 0.75954806460340585, 0.63477157797617245, 0.5, 0.36522842202382749, 0.2404519353965941, 0.13492399721297532, 0.056468700115952342, 0.010885670926971514],
[0.99078031712335957, 0.95205862818523745, 0.88495133709715224, 0.79365897714330869, 0.68391574949909006, 0.5626167042557344, 0.43738329574426549, 0.31608425050090988, 0.20634102285669126, 0.1150486629028476, 0.047941371814762546, 0.0092196828766403782],
[0.99209152735929407, 0.95879919961148896, 0.90078904536665494, 0.82117466972017006, 0.72424637551822335, 0.61522915797756739, 0.5, 0.38477084202243261, 0.27575362448177654, 0.17882533027982989, 0.099210954633345005, 0.041200800388511039, 0.007908472640705877],
[0.99314190434840621, 0.96421744183178681, 0.91360065753488251, 0.84364645240584268, 0.75762431817907705, 0.65955618446394482, 0.55402747435367183, 0.44597252564632817, 0.34044381553605513, 0.24237568182092295, 0.15635354759415726, 0.08639934246511749, 0.035782558168213241, 0.0068580956515938429]
]

GaussLegendreWeights = [
[0.27777777777777835, 0.44444444444444442, 0.27777777777777724],
[0.1739274225687282, 0.32607257743127338, 0.32607257743127271, 0.1739274225687259],
[0.11846344252809539, 0.23931433524968357, 0.28444444444444444, 0.2393143352496831, 0.11846344252809393],
[0.085662246189585275, 0.18038078652406944, 0.23395696728634541, 0.23395696728634555, 0.18038078652406908, 0.085662246189584831],
[0.064742483084435212, 0.13985269574463843, 0.19091502525255949, 0.2089795918367347, 0.19091502525255941, 0.13985269574463841, 0.064742483084434546],
[0.0506142681451884, 0.11119051722668746, 0.15685332293894372, 0.181341891689181, 0.181341891689181, 0.15685332293894363, 0.1111905172266872, 0.050614268145187803],
[0.040637194180787546, 0.0903240803474291, 0.13030534820146791, 0.15617353852000149, 0.16511967750062989, 0.1561735385200014, 0.13030534820146772, 0.090324080347428518, 0.040637194180786686],
[0.033335672154344714, 0.074725674575291237, 0.10954318125799148, 0.13463335965499842, 0.14776211235737649, 0.14776211235737641, 0.13463335965499809, 0.10954318125799074, 0.074725674575289669, 0.03333567215434291],
[0.027834283558087185, 0.062790184732452473, 0.093145105463867298, 0.11659688229599534, 0.13140227225512338, 0.13646254338895031, 0.13140227225512327, 0.11659688229599523, 0.09314510546386702, 0.062790184732452195, 0.027834283558086554],
[0.023587668193256826, 0.053469662997660185, 0.080039164271673749, 0.10158371336153328, 0.11674626826917762, 0.12457352290670146, 0.12457352290670136, 0.11674626826917733, 0.1015837133615328, 0.08003916427167275, 0.053469662997658561, 0.023587668193254235],
[0.020242002382658223, 0.046060749918864691, 0.069436755109893944, 0.089072990380973063, 0.10390802376844432, 0.1131415901314487, 0.11627577661543695, 0.1131415901314486, 0.10390802376844416, 0.08907299038097273, 0.0694367551098935, 0.046060749918864025, 0.020242002382657165],
[0.017559730165876, 0.040079043579880277, 0.060759285343951815, 0.078601583579096815, 0.092769198738968967, 0.1025992318606478, 0.10763192673157888, 0.10763192673157888, 0.1025992318606478, 0.092769198738968897, 0.07860158357909669, 0.0607592853439516, 0.040079043579880028, 0.017559730165875635]
]

# Clenshaw-Curtis quadrature 
# http://en.wikipedia.org/wiki/Clenshaw%E2%80%93Curtis_quadrature
# http://www.scientificpython.net/1/post/2012/04/clenshaw-curtis-quadrature.html

def ClenshawCurtisCoefs(n1):
	if n1 == 1:
		x = 0
		w = 2
	else:
		n = n1 - 1
		C = zeros((n1,2))
		k = 2*(1+arange(np.floor(n/2)))
		C[::2,0] = 2/hstack((1, 1-k*k))
		C[1,1] = -n
		V = vstack((C,flipud(C[1:n,:])))
		F = real(ifft(V, n=None, axis=0))
		x = F[0:n1,1]
		w = hstack((F[0,0],2*F[1:n,0],F[n,0]))
	#return x,w
	return 0.5*(x+1.0),0.5*w

ClenshawCurtisNodes = [
[0.0, 0.5, 1.0],
[0.0, 0.25, 0.75, 1.0],
[0.0, 0.14644660940672627, 0.5, 0.85355339059327373, 1.0],
[0.0, 0.095491502812526274, 0.34549150281252627, 0.65450849718747373, 0.90450849718747373, 1.0],
[0.0, 0.066987298107780702, 0.25, 0.5, 0.75, 0.9330127018922193, 1.0],
[0.0, 0.049515566048790371, 0.1882550990706332, 0.38873953302184272, 0.61126046697815728, 0.8117449009293668, 0.95048443395120963, 1.0],
[0.0, 0.038060233744356631, 0.14644660940672621, 0.30865828381745508, 0.5, 0.69134171618254492, 0.85355339059327373, 0.96193976625564337, 1.0],
[0.0, 0.030153689607045786, 0.11697777844051105, 0.25, 0.41317591116653485, 0.58682408883346515, 0.75, 0.88302222155948895, 0.96984631039295421, 1.0],
[0.0, 0.024471741852423179, 0.095491502812526274, 0.20610737385376338, 0.34549150281252627, 0.5, 0.65450849718747373, 0.79389262614623668, 0.90450849718747373, 0.97552825814757682, 1.0],
[0.0, 0.02025351319275126, 0.079373233584409397, 0.17256963302735745, 0.29229249349905678, 0.42884258086335736, 0.57115741913664264, 0.70770750650094327, 0.82743036697264261, 0.9206267664155906, 0.97974648680724874, 1.0],
[0.0, 0.017037086855465844, 0.066987298107780702, 0.14644660940672621, 0.25, 0.37059047744873963, 0.5, 0.62940952255126037, 0.75, 0.85355339059327373, 0.9330127018922193, 0.9829629131445341, 1.0],
[0.0, 0.014529091286973994, 0.057271987173395045, 0.1257446259144494, 0.21596762663442204, 0.32269755647873211, 0.43973165987233842, 0.56026834012766158, 0.67730244352126789, 0.78403237336557796, 0.87425537408555054, 0.9427280128266049, 0.98547090871302601, 1.0]
]

ClenshawCurtisWeights = [
[0.16666666666666669, 0.66666666666666663, 0.16666666666666669],
[0.055555555555555559, 0.44444444444444442, 0.44444444444444442, 0.055555555555555559],
[0.03333333333333334, 0.26666666666666666, 0.40000000000000002, 0.26666666666666666, 0.03333333333333334],
[0.020000000000000004, 0.18037152060000561, 0.29962847939999437, 0.29962847939999437, 0.18037152060000561, 0.020000000000000004],
[0.01428571428571429, 0.12698412698412698, 0.22857142857142856, 0.26031746031746028, 0.22857142857142856, 0.12698412698412698, 0.01428571428571429],
[0.010204081632653064, 0.095070503609104157, 0.17612121185907956, 0.21860420289916319, 0.21860420289916319, 0.17612121185907956, 0.095070503609104157, 0.010204081632653064],
[0.007936507936507943, 0.073109324608009077, 0.13968253968253969, 0.18085892936024489, 0.19682539682539685, 0.18085892936024489, 0.13968253968253969, 0.073109324608009077, 0.007936507936507943],
[0.0061728395061728418, 0.058283728286018549, 0.11264216166905219, 0.1509700176366843, 0.17193125290207203, 0.17193125290207203, 0.1509700176366843, 0.11264216166905219, 0.058283728286018549, 0.0061728395061728418],
[0.0050505050505050553, 0.047289527441850776, 0.092817607212123912, 0.12679416664184331, 0.14960663521211856, 0.1568831168831169, 0.14960663521211856, 0.12679416664184331, 0.092817607212123912, 0.047289527441850776, 0.0050505050505050553],
[0.0041322314049586795, 0.039280076873099999, 0.077520227541280684, 0.10778127300043429, 0.12995867053345808, 0.14132752064676826, 0.14132752064676826, 0.12995867053345808, 0.10778127300043429, 0.077520227541280684, 0.039280076873099999, 0.0041322314049586795],
[0.0034965034965034982, 0.033028712476037198, 0.065771265771265769, 0.092381692381692374, 0.11348651348651348, 0.12633784689052213, 0.13099493099493098, 0.12633784689052213, 0.11348651348651348, 0.092381692381692374, 0.065771265771265769, 0.033028712476037198, 0.0034965034965034982],
[0.0029585798816568068, 0.02823265688170723, 0.056384336244928279, 0.080019013058359331, 0.099496205182891623, 0.11295152488928223, 0.11995768386117452, 0.11995768386117452, 0.11295152488928223, 0.099496205182891623, 0.080019013058359331, 0.056384336244928279, 0.02823265688170723, 0.0029585798816568068]
]