<!DOCTYPE html>
<html>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.js"></script>
    <script src="../PlanetDesigner/GLSLscreen.js"></script>
    <head>
        <title>05.10 - Custom fragment shader</title>
        <style> body { margin: 0; overflow: scroll;; } </style>
    </head>
    
    <script>
        var shader_name = "";
        var shaderSources = {};

        function loadShader(name, url){
            return fetch(url)
                .then(function(response){ return response.text(); })
                .then(function(text){ shaderSources[name] = text; });
        }

        var shadersReady = Promise.all([
            loadShader("Vorticity", "Vorticity.glslf"),
            loadShader("Harmonics", "Harmonics.glslf")
        ]);

        function getShaderCode(){
            shader_name = document.getElementById("slShader").value;
            console.log("Shader:", shader_name);
            return shaderSources[shader_name] || "";
        }

        function updateSurface(){
            if (shaderSources[document.getElementById("slShader").value]){
                updateShader(getShaderCode());
                updateShaderSourceView();
            }else{
                shadersReady.then(function(){
                    updateShader(getShaderCode());
                    updateShaderSourceView();
                });
            }
        }

        function updateShaderSourceView(){
            var srcElem = document.getElementById("shaderSource");
            if (srcElem){
                srcElem.textContent = getShaderCode();
            }
        }

        function initThis(){ 
            shadersReady.then(function(){
                init_GLSLScreen("GLScreen", getShaderCode()); 
                updateShaderSourceView();
            });
        } 
    </script>
    <body onLoad="initThis()">
        <div style="width: 640px;height: 480px;" id="GLScreen"></div>
        <div style="width: 1200px;">
            <select id="slShader" onChange="updateSurface()">
                <option value="Vorticity" >Vorticity</option>
                <option value="Harmonics" >Harmonics</option>
            </select>
            <BR>
			<pre id="shaderSource" style="white-space: pre-wrap; border: 1px solid #444; padding: 4px;"></pre>
        </div>
    </body>
</html>
